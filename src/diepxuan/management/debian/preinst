#!/usr/bin/env bash
#!/bin/bash
#!/bin/sh
# preinst script
#
# see: dh_installdeb(1)

set -e

# summary of how this script can be called:
#        * <new-preinst> `install'
#        * <new-preinst> `install' <old-version>
#        * <new-preinst> `upgrade' <old-version>
#        * <old-preinst> `abort-upgrade' <new-version>
# for details, see http://www.debian.org/doc/debian-policy/ or
# the debian-policy package

case "$1" in
install | upgrade)
    systemctl stop ductnd.service >/dev/null 2>&1 || true

    dirs_to_remove=(
        "/etc/sysctl.d/99-ductn.conf"
        "/etc/cron.daily/ductn"
    )

    for dir in "${dirs_to_remove[@]}"; do
        [[ -d "$dir" ]] && rm -rf "$dir"
    done

    current_tz=$(timedatectl show -p Timezone --value 2>/dev/null || echo "Etc/UTC")
    # Nếu timezone là UTC thì đổi sang Asia/Ho_Chi_Minh
    if [[ "$current_tz" == "Etc/UTC" ]]; then
        timedatectl set-timezone Asia/Ho_Chi_Minh || true
    fi
    ;;

abort-upgrade) ;;

*)
    echo "preinst called with unknown argument \`$1'" >&2
    exit 1
    ;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0
